/* ---------- Module Root & Tokens (scoped) ---------- */
/* Put the theme vars on .waicm so nothing leaks globally */
.waicm {
  --ai-accent: #47a5ae;
  --ai-accent-rgb: 71,165,174;
  --ai-accent-strong: #2f7d85;

  --ai-bg: #ffffff;
  --ai-surface: #ffffff;
  --ai-soft: #0a0f1d;
  --ai-text: #e5e7eb;
  --ai-subtle: #9ca3af;
  --ai-border: rgba(255,255,255,.12);

  --ai-user-bubble: rgba(var(--ai-accent-rgb), .16);
  --ai-bot-bubble: rgba(255,255,255,.06);

  --ai-radius: 14px;
  --ai-pill: 999px;

  --ai-shadow-soft: 0 18px 45px rgba(0,0,0,.45);
}

/* ---------- Bubble (launcher) ---------- */
.waicm .ai-chat-min__bubble {
  position: fixed;
  right: 24px;
  bottom: calc(24px + env(safe-area-inset-bottom));
  z-index: 1050;

  width: 60px;
  height: 60px;
  border-radius: 50%;

  border: none;
  background: radial-gradient(circle at 30% 0%, #6ee7b7 0, var(--ai-accent) 60%, #0b1a24 100%);
  box-shadow: 0 15px 35px rgba(0,0,0,.55);

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2px;

  color: #f9fafb;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;

  transition: transform .16s ease, box-shadow .16s ease, opacity .12s ease;
}
.waicm .ai-chat-min__bubble:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 20px 45px rgba(0,0,0,.7);
}
.waicm .ai-chat-min__bubble:active {
  transform: translateY(0) scale(.98);
  box-shadow: 0 10px 30px rgba(0,0,0,.5);
}
.waicm .ai-chat-min__bubble:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 3px;
}

.waicm .ai-chat-min__bubble-icon {
  width: 24px;
  height: 24px;
  border-radius: 8px;
  background: rgba(15,23,42,.8);
  padding: 2px;
}

.waicm .ai-chat-min__bubble-label {
  text-shadow: 0 1px 2px rgba(0,0,0,.4);
}

/* ---------- Panel (chat window) ---------- */
.waicm .ai-chat-min__panel {
  position: fixed;
  right: 24px;
  bottom: calc(96px + env(safe-area-inset-bottom));
  z-index: 1051;

  width: min(420px, 96vw);
  height: min(520px, 70vh);

  display: flex;
  flex-direction: column;

  background: radial-gradient(circle at top left, #111827 0, #020617 40%, #020617 100%);
  border-radius: 20px;
  border: 1px solid rgba(148, 163, 184, .35);
  box-shadow: var(--ai-shadow-soft);
  overflow: hidden;
}

/* Max mode */
.waicm .ai-chat-min__panel.ai-chat-min__panel--max {
  right: 50%;
  transform: translateX(50%);
  top: 8vh;
  bottom: calc(8vh + env(safe-area-inset-bottom));
  width: min(900px, 96vw);
  height: auto;
}

/* ---------- Header ---------- */
.waicm .ai-chat-min__header {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;

  padding: 10px 12px;
  border-bottom: 1px solid rgba(148,163,184,.35);
  background: linear-gradient(135deg, rgba(15,23,42,.98), rgba(15,23,42,.92));
}
.waicm .ai-chat-min__header > div:first-child {
  font-weight: 600;
  font-size: 13px;
  color: #e5e7eb;
  letter-spacing: .03em;
  text-transform: uppercase;
}

/* Header buttons */
.waicm .ai-chat-min__reset,
.waicm .ai-chat-min__max,
.waicm .ai-chat-min__close {
  margin-left: auto;
  background: rgba(15,23,42, .9);
  border: 1px solid rgba(148,163,184,.4);
  color: inherit;
  font-size: 16px;
  line-height: 1;
  border-radius: 6px;
  cursor: pointer;
  opacity: .95;
  transition: transform .12s ease, opacity .12s ease;
}
.waicm .ai-chat-min__reset { margin-right: 4px; }
.waicm .ai-chat-min__max { margin-right: 4px; }

.waicm .ai-chat-min__max:hover,
.waicm .ai-chat-min__close:hover,
.waicm .ai-chat-min__reset:hover {
  opacity: 1;
  transform: scale(1.08);
}
.waicm .ai-chat-min__max:focus-visible,
.waicm .ai-chat-min__close:focus-visible,
.waicm .ai-chat-min__reset:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 2px;
}

/* ---------- Body (fills + scroll) ---------- */
.waicm .ai-chat-min__body {
  display: flex;                   /* column so bubbles shrink-to-fit */
  flex-direction: column;
  gap: 6px;
  padding: 12px;

  flex: 1 1 auto;
  overflow-y: auto;
  overscroll-behavior: contain;

  background: radial-gradient(circle at 0 0, rgba(148,163,184,.06), transparent 55%);
}

/* ---------- Messages ---------- */
.waicm .ai-chat-min__msg {
  display: flex;
  width: 100%;
  font-size: 13px;
}

.waicm .ai-chat-min__msg--user {
  justify-content: flex-end;
}
.waicm .ai-chat-min__msg--bot {
  justify-content: flex-start;
}

.waicm .ai-chat-min__msg-bubble {
  max-width: 82%;
  padding: 8px 11px;
  border-radius: 12px;
  border: 1px solid transparent;

  word-wrap: break-word;
  word-break: break-word;
}

/* User bubble */
.waicm .ai-chat-min__msg--user .ai-chat-min__msg-bubble {
  background: var(--ai-user-bubble);
  color: #ecfeff;
  border-color: rgba(56,189,248,.35);
  border-bottom-right-radius: 4px;
}

/* Bot bubble */
.waicm .ai-chat-min__msg--bot .ai-chat-min__msg-bubble {
  background: var(--ai-bot-bubble);
  color: var(--ai-text);
  border-color: rgba(148,163,184,.3);
  border-bottom-left-radius: 4px;
}

/* Rich bot bubble (markdown) */
.waicm .ai-chat-min__msg-bubble--rich {
  padding: 10px 12px;
}

/* ---------- Footer ---------- */
.waicm .ai-chat-min__footer {
  display: flex;
  gap: 6px;
  padding: 10px 12px 12px;
  border-top: 1px solid rgba(148,163,184,.3);
  background: linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.96));
}

.waicm .ai-chat-min__input {
  flex: 1;
  min-width: 0;
  padding: 7px 10px;
  border-radius: 999px;
  border: 1px solid rgba(148,163,184,.6);
  background: rgba(15,23,42,.96);
  color: #e5e7eb;
  font-size: 13px;
}
.waicm .ai-chat-min__input::placeholder {
  color: rgba(148,163,184,.8);
}
.waicm .ai-chat-min__input:focus-visible {
  outline: 2px solid var(--ai-accent-strong);
  outline-offset: 1px;
}

/* SEND button */
.waicm .ai-chat-min__send {
  padding: 7px 14px;
  border-radius: 999px;
  border: none;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: #ecfdf5;
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
  box-shadow: 0 8px 18px rgba(22,163,74,.55);
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.waicm .ai-chat-min__send:hover {
  transform: translateY(-1px);
  box-shadow: 0 12px 26px rgba(22,163,74,.7);
}
.waicm .ai-chat-min__send:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(22,163,74,.55);
}
.waicm .ai-chat-min__send:disabled {
  opacity: .6;
  cursor: default;
  box-shadow: none;
}

/* ---------- Markdown / Bot UI ---------- */
.waicm .waicm-title {
  margin: 0 0 4px;
  font-size: 13px;
  font-weight: 600;
}
.waicm .waicm-summary {
  margin: 0 0 6px;
  font-size: 12px;
  color: var(--ai-subtle);
}
.waicm .waicm-answer p {
  margin: 0 0 4px;
  font-size: 13px;
}
.waicm .waicm-answer h3,
.waicm .waicm-answer h4,
.waicm .waicm-answer h5 {
  margin: 6px 0 4px;
  font-weight: 600;
  font-size: 13px;
}
.waicm .waicm-answer ul {
  margin: 0 0 4px 16px;
  padding: 0;
}
.waicm .waicm-answer li {
  margin: 0 0 2px;
}

/* Suggestions */
.waicm .waicm-suggestions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}
.waicm .waicm-suggest {
  border: 1px solid var(--ai-border);
  border-radius: var(--ai-pill);
  padding: 6px 12px;
  cursor: pointer;
  background: rgba(var(--ai-accent-rgb), .12);
  color: rgb(var(--ai-accent-rgb));
  transition: background .12s ease, transform .08s ease;
}
.waicm .waicm-suggest:hover { background: rgba(var(--ai-accent-rgb), .18); transform: translateY(-1px); }

/* ---------- Mobile ---------- */
@media (max-width: 480px) {
  .waicm .ai-chat-min__panel { right: 4vw; width: 92vw; bottom: calc(88px + env(safe-area-inset-bottom)); height: min(70vh, 600px); }
  .waicm .ai-chat-min__bubble { width: 56px; height: 56px; font-size: 22px; }
  .waicm .ai-chat-min__panel.ai-chat-min__panel--max {
    top: 8px; left: 4vw; right: 4vw;
    bottom: calc(8px + env(safe-area-inset-bottom));
    width: auto; height: auto;
  }
}

/* ---------- Model Selector (per-user limits) ---------- */
.waicm .ai-chat-min__models {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-bottom: 1px solid var(--ai-border);
  background: #0b1020;
}

.waicm .ai-chat-min__model-label {
  font-size: 0.78rem;
  color: var(--ai-subtle);
  white-space: nowrap;
}

.waicm .ai-chat-min__model-select {
  flex: 0 0 auto;
  min-width: 0;
  max-width: 65%;
  padding: 6px 10px;
  border-radius: var(--ai-radius);
  border: 1px solid var(--ai-border);
  background: #0d1222;
  color: var(--ai-text);
  font-size: 0.85rem;
}

.waicm .ai-chat-min__model-select:focus-visible {
  outline: 2px solid var(--ai-accent-strong);
  outline-offset: 1px;
}

.waicm .ai-chat-min__model-limit {
  margin-left: auto;
  font-size: 0.75rem;
  color: var(--ai-subtle);
  white-space: nowrap;
}

/* Mobile: stack the selector nicely */
@media (max-width: 480px) {
  .waicm .ai-chat-min__models {
    flex-wrap: wrap;
    align-items: flex-start;
  }
  .waicm .ai-chat-min__model-select {
    max-width: 100%;
  }
  .waicm .ai-chat-min__model-limit {
    width: 100%;
    margin-left: 0;
    margin-top: 4px;
  }
}
