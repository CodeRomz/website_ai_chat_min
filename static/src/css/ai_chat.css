/* Design tokens (light & dark aware) */
:root {
  --ai-brand: #4f46e5;
  --ai-dark: #0f172a;
  --ai-light: #ffffff;
  --ai-subtle: #64748b;
  --ai-border: #e2e8f0;
  --ai-shadow: 0 10px 30px rgba(2, 6, 23, 0.15);
  --ai-radius: 16px;
  --ai-z: 9999;
  --ai-safe-bottom: env(safe-area-inset-bottom, 0px);
}

@media (prefers-color-scheme: dark) {
  :root {
    --ai-dark: #0b1020;
    --ai-light: #0f172a;
    --ai-subtle: #9aa7bd;
    --ai-border: #1f2a44;
    --ai-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
  }
}

/* Reduced motion = fewer animations */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}

/* Container that holds bubble + panel */
.ai-chat-min__wrap {
  position: fixed;
  right: 20px;
  bottom: calc(35px + var(--ai-safe-bottom));
  z-index: var(--ai-z);
  pointer-events: none; /* allow clicks only on children we enable */
}

/* Floating action button (bubble) */
.ai-chat-min__bubble {
  pointer-events: auto;
  width: 52px;
  height: 52px;
  border-radius: 9999px;
  border: none;
  background: var(--ai-brand);
  color: #fff;
  font-size: 22px;
  box-shadow: var(--ai-shadow);
  cursor: pointer;
  display: grid;
  place-items: center;
  transition: transform 150ms ease;
}
.ai-chat-min__bubble:hover { transform: translateY(-2px); }
.ai-chat-min__bubble:active { transform: translateY(0); }
.ai-chat-min__bubble:focus-visible {
  outline: 3px solid rgba(79, 70, 229, 0.5);
  outline-offset: 2px;
}

/* Panel (dialog) */
.ai-chat-min__panel {
  pointer-events: auto;
  position: fixed;
  right: 20px;
  bottom: calc(88px + var(--ai-safe-bottom));
  width: 400px;
  max-width: calc(100vw - 40px);
  height: 540px;
  max-height: calc(100vh - 140px);
  display: flex;
  flex-direction: column;
  background: var(--ai-light);
  color: #0b1220;
  border: 1px solid var(--ai-border);
  border-radius: var(--ai-radius);
  box-shadow: var(--ai-shadow);
  overflow: hidden;
}
.ai-chat-min__panel[hidden] { display: none !important; }

/* Header */
.ai-chat-min__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 12px 12px 16px;
  background: linear-gradient(180deg, rgba(79, 70, 229, 0.10), transparent);
  border-bottom: 1px solid var(--ai-border);
}
.ai-chat-min__title { font-weight: 600; }
.ai-chat-min__close {
  border: none; background: transparent; cursor: pointer;
  width: 32px; height: 32px; border-radius: 8px; font-size: 16px;
}
.ai-chat-min__close:hover { background: rgba(15, 23, 42, 0.05); }
.ai-chat-min__close:focus-visible {
  outline: 2px solid rgba(79, 70, 229, 0.5);
  outline-offset: 2px;
}

/* Body (messages stream) */
.ai-chat-min__body {
  flex: 1;
  overflow: auto;
  padding: 12px;
  display: grid;
  gap: 8px;
}
.ai-chat-min__body::-webkit-scrollbar { width: 10px; }
.ai-chat-min__body::-webkit-scrollbar-thumb { background: rgba(100, 116, 139, 0.4); border-radius: 8px; }

/* Message rows */
.ai-chat-min__msg { display: flex; }
.ai-chat-min__msg.user { justify-content: flex-end; }
.ai-chat-min__msg.bot { justify-content: flex-start; }
.ai-chat-min__msgbubble {
  max-width: 86%;
  padding: 10px 12px;
  border-radius: 14px;
  line-height: 1.35;
  white-space: pre-wrap;
  word-break: break-word;
}
.ai-chat-min__msg.user .ai-chat-min__msgbubble {
  background: #e9efff; color: #0b1220;
}
.ai-chat-min__msg.bot .ai-chat-min__msgbubble {
  background: #f1f5f9; color: #0b1220;
}

/* Footer */
.ai-chat-min__footer {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  padding: 10px;
  border-top: 1px solid var(--ai-border);
  background: rgba(15, 23, 42, 0.02);
}
.ai-chat-min__input {
  width: 100%;
  min-height: 38px;
  max-height: 120px;
  resize: vertical;
  border: 1px solid var(--ai-border);
  border-radius: 10px;
  padding: 8px 10px;
  background: #fff;
}
.ai-chat-min__input:focus-visible {
  outline: 2px solid rgba(79, 70, 229, 0.5);
  outline-offset: 2px;
}
.ai-chat-min__send {
  min-width: 82px;
  border: none;
  border-radius: 10px;
  background: var(--ai-brand);
  color: #fff;
  padding: 0 14px;
  cursor: pointer;
}
.ai-chat-min__send:disabled { opacity: 0.6; cursor: not-allowed; }

/* Structured UI blocks */
.ai-chat-min__ui-title { font-weight: 700; margin-bottom: 4px; }
.ai-chat-min__ui-summary { color: var(--ai-subtle); margin-bottom: 8px; }
.ai-chat-min__ui-answer { margin-bottom: 8px; position: relative; }
.ai-chat-min__ui-answer.clamp {
  display: -webkit-box;
  -webkit-line-clamp: 6;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.ai-chat-min__ui-answer.clamp::after {
  content: "";
  position: absolute;
  bottom: 0; left: 0; right: 0; height: 28px;
  background: linear-gradient(180deg, rgba(241, 245, 249, 0), rgba(241, 245, 249, 1));
}
.ai-chat-min__more {
  border: none; background: transparent; color: var(--ai-brand);
  padding: 0; cursor: pointer; font-weight: 600;
}

/* Citations & suggestions */
.ai-chat-min__citations { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; margin-bottom: 6px; }
.ai-chat-min__citlabel { font-size: 12px; color: var(--ai-subtle); margin-right: 4px; }
.ai-chat-min__chip {
  font-size: 12px; padding: 4px 6px;
  background: #eef2ff; border: 1px solid #dfe3ff; border-radius: 999px;
}
.ai-chat-min__sugs { display: flex; flex-wrap: wrap; gap: 6px; }
.ai-chat-min__sug {
  border: 1px solid var(--ai-border); background: #fff; color: #0b1220;
  border-radius: 999px; padding: 6px 10px; cursor: pointer;
}
.ai-chat-min__sug:hover { background: #f8fafc; }

/* Mobile / tablets */
@media (max-width: 768px) {
  .ai-chat-min__panel {
    right: 12px; bottom: calc(82px + var(--ai-safe-bottom));
    width: calc(100vw - 24px); height: min(70vh, 560px);
  }
}
@media (max-width: 480px) {
  .ai-chat-min__bubble { width: 48px; height: 48px; font-size: 20px; }
  .ai-chat-min__panel { height: min(68vh, 520px); }
}

/* RTL support */
[dir="rtl"] .ai-chat-min__panel { right: auto; left: 20px; }
[dir="rtl"] .ai-chat-min__msg.user { justify-content: flex-start; }
[dir="rtl"] .ai-chat-min__msg.bot { justify-content: flex-end; }
