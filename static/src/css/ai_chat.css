/* ---------- Brand & Tokens ---------- */
:root {
  --ai-accent: #47a5ae;
  --ai-accent-rgb: 71,165,174;
  --ai-accent-strong: #2f7d85;

  --ai-bg: #ffffff;
  --ai-surface: #ffffff;
  --ai-soft: #0a0f1d; /* keep your dark theme body */
  --ai-text: #e5e7eb;
  --ai-subtle: #9ca3af;
  --ai-border: rgba(255,255,255,.12);

  --ai-user-bubble: rgba(var(--ai-accent-rgb), .16);
  --ai-bot-bubble: rgba(255,255,255,.06);

  --ai-elev: 0 16px 42px rgba(0,0,0,.45);
  --ai-fab-shadow: 0 6px 18px rgba(255,255,255,.35);
  --ai-fab-pulse: 0 0 0 10px rgba(var(--ai-accent-rgb), .15);
  --ai-btn-shadow: 0 4px 14px rgba(var(--ai-accent-rgb), .30);

  --ai-radius: 12px;
  --ai-pill: 999px;
}

/* Prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
  .ai-chat-min__bubble { animation: none !important; transition: none !important; }
}

/* ---------- Wrapper ---------- */
.ai-chat-min__wrap {
  position: fixed;
  right: 45px;
  bottom: calc(35px + env(safe-area-inset-bottom));
  z-index: 2147483640;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
}

/* ---------- Floating bubble ---------- */
.ai-chat-min__bubble {
  width: 68px;
  height: 68px;
  border: 0;
  border-radius: 50%;
  cursor: pointer;
  background: var(--ai-accent-strong);
  color: #fff;
  font-size: 24px;
  display: grid;
  place-items: center;
  box-shadow: var(--ai-fab-shadow);
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  user-select: none;
  animation: ai-min-pulse 2.6s ease-in-out infinite;
}
.ai-chat-min__bubble:hover { transform: translateY(-2px); }
.ai-chat-min__bubble:active { transform: translateY(0) scale(.98); }
.ai-chat-min__bubble:focus-visible { outline: 3px solid #fff; outline-offset: 3px; }
@keyframes ai-min-pulse { 0%,100% { box-shadow: var(--ai-fab-shadow); } 50% { box-shadow: var(--ai-fab-pulse); } }

/* ---------- Panel ---------- */
.ai-chat-min__panel[hidden] { display: none !important; }
.ai-chat-min__panel {
  position: fixed;
  right: 20px;
  bottom: calc(88px + env(safe-area-inset-bottom));
  width: 360px;
  max-width: calc(100vw - 40px);
  height: 600px;                 /* fixed height as requested */
  display: flex;
  flex-direction: column;
  color: var(--ai-text);
  border-radius: var(--ai-radius);
  box-shadow: var(--ai-elev);
  overflow: hidden;
  transform-origin: bottom right;
  transition: opacity .14s ease, transform .14s ease;
}

/* === Maximized panel state === */
.ai-chat-min__panel.is-max {
  top: 16px;
  left: 16px;
  right: 16px;
  bottom: calc(16px + env(safe-area-inset-bottom));
  width: auto;
  height: auto;
  max-width: none;
  max-height: none;
  border-radius: 10px;
}

/* ---------- Header (aligned) ---------- */
.ai-chat-min__header {
  display: flex;
  align-items: center;
  justify-content: flex-start;    /* keep items together */
  height: 44px;                   /* fixed bar height */
  padding: 0 12px;                /* vertical size driven by height */
  background: var(--ai-accent-strong);
  color: #fff;
}
/* title left, buttons pushed to the right */
.ai-chat-min__header > :first-child {
  margin-right: auto;
  line-height: 1;
}

/* buttons are square, centered, same size */
.ai-chat-min__max,
.ai-chat-min__close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  padding: 0;
  margin: 0;
  border: 0;
  background: transparent;
  color: inherit;
  font-size: 16px;
  line-height: 1;                 /* avoid baseline wobble */
  border-radius: 6px;
  cursor: pointer;
  opacity: .95;
  transition: transform .12s ease, opacity .12s ease;
}
.ai-chat-min__max { margin-right: 4px; } /* small gap between max and close */
.ai-chat-min__close:hover, .ai-chat-min__max:hover { opacity: 1; transform: scale(1.08); }
.ai-chat-min__close:focus-visible, .ai-chat-min__max:focus-visible { outline: 2px solid #fff; outline-offset: 2px; }

/* ---------- Body (fills + scroll) ---------- */
.ai-chat-min__body {
  display: flex;                   /* flex column so bubbles shrink-to-fit and align like LinkedIn */
  flex-direction: column;
  gap: 6px;
  padding: 12px;
  overflow: auto;
  background: #0b1020;            /* dark body */
  scrollbar-width: thin;
  scrollbar-color: var(--ai-subtle) transparent;

  flex: 1 1 auto;                 /* take remaining height inside panel */
  min-height: 0;                  /* enable scrolling in flex container */
}
.ai-chat-min__body::-webkit-scrollbar { width: 10px; }
.ai-chat-min__body::-webkit-scrollbar-thumb { background: var(--ai-subtle); border-radius: 6px; }

/* ---------- Message Bubbles (LinkedIn-like) ---------- */
.ai-chat-min__msg {
  display: inline-flex;            /* shrink to content */
  align-items: flex-start;
  padding: 10px 12px;
  border-radius: 16px;
  max-width: 78%;                  /* limit bubble width */
  width: -moz-fit-content;         /* Firefox */
  width: fit-content;              /* others */
  word-break: break-word;
  overflow-wrap: anywhere;         /* wrap long tokens/URLs */
  border: 1px solid var(--ai-border);
  background: var(--ai-bot-bubble);
}
.ai-chat-min__msg.bot  { align-self: flex-start; } /* left bubble */
.ai-chat-min__msg.user {
  align-self: flex-end;            /* right bubble */
  background: var(--ai-user-bubble);
  text-align: left;                /* natural text alignment */
}

/* ---------- Footer ---------- */
.ai-chat-min__footer {
  display: flex; gap: 8px; padding: 12px;
  border-top: 1px solid var(--ai-border);
  background: #0b1020;
}
.ai-chat-min__footer input {
  flex: 1; min-width: 0;
  padding: 10px 12px;
  border: 1px solid var(--ai-border);
  border-radius: var(--ai-radius);
  background: #0d1222;
  color: var(--ai-text);
}
.ai-chat-min__footer input::placeholder { color: var(--ai-subtle); }
.ai-chat-min__footer input:focus-visible { outline: 2px solid var(--ai-accent-strong); outline-offset: 1px; }
.ai-chat-min__send {
  appearance: none;
  padding: 10px 14px;
  border: 0;
  border-radius: var(--ai-radius);
  background: var(--ai-accent-strong);
  color: #fff; font-weight: 600; cursor: pointer;
  box-shadow: var(--ai-btn-shadow);
  transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
}
.ai-chat-min__send:hover { transform: translateY(-1px); }
.ai-chat-min__send:active { transform: translateY(0) scale(.98); }
.ai-chat-min__send:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }

/* ---------- Markdown ---------- */
.ai-md { line-height: 1.35; white-space: pre-wrap; max-width: 100%; }
.ai-box { display: block; }
.ai-md ul, .ai-md ol { margin: 6px 0 0; padding-left: 1.1rem; }
.ai-md li { margin: 2px 0; }
.ai-md p { margin: 0.35rem 0; }
.ai-md code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  background: rgba(255,255,255,.06);
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 12px;
}

/* ---------- Chips (optional UI) ---------- */
.ai-citations { margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap; }
.ai-chip { font-size: .85em; padding: 4px 10px; border-radius: var(--ai-pill);
  background: rgba(var(--ai-accent-
